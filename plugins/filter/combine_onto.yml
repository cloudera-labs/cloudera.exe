# Copyright 2025 Cloudera, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
---
DOCUMENTATION:
  name: combine_onto
  author: Webster Mudge (@wmudge) <wmudge@cloudera.com>
  short_description: combine two dictionaries
  description:
    - Create a dictionary (hash/associative array) as a result of merging existing dictionaries.
    - This is the reverse of the C(ansible.builtin.combine) filter.
  positional: _input, _dicts
  options:
    _input:
      description:
        - First dictionary to combine.
      type: dict
      required: true
    _dicts:
      description:
        - The list of dictionaries to combine
      type: list
      elements: dict
      required: true
    recursive:
      description:
        - If V(True), merge elements recursively.
      type: boolean
      default: false
    list_merge:
      description: Behavior when encountering list elements.
      type: str
      default: replace
      choices:
        replace: overwrite older entries with newer ones
        keep: discard newer entries
        append: append newer entries to the older ones
        prepend: insert newer entries in front of the older ones
        append_rp: append newer entries to the older ones, overwrite duplicates
        prepend_rp: insert newer entries in front of the older ones, discard duplicates

EXAMPLES: |
  # ab => {'a':1, 'b':2, 'c': 4}
  ab: "{{ {'a':1, 'b':2} | cloudera.exe.combine_onto({'b':3, 'c':4}) }}"

  many: "{{ dict1 | cloudera.exe.combine_onto(dict2, dict3, dict4) }}"

  # defaults => {'a':{'b':3, 'c':4}, 'd': 5}
  # customization => {'a':{'c':20}}
  # final => {'a':{'b':3, 'c':20}, 'd': 5}
  final: "{{ customization | cloudera.exe.combine_onto(defaults, recursive=true) }}"

RETURN:
  _value:
    description: Resulting merge of supplied dictionaries.
    type: dict
