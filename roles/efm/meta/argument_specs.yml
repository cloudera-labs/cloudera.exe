---
# Copyright 2025 Cloudera, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

argument_specs:
  main:
    short_description: Install and configure Cloudera Edge Flow Manager (EFM)
    description:
      - Validates required configuration variables based on enabled features (TLS, LDAP).
      - Downloads, installs, and configures Cloudera Edge Flow Manager (EFM) on the target host.
      - Sets up the EFM properties, and manages the systemd service.
    author: Cloudera Labs
    version_added: "3.2.0"
    options:
      efm_tarball_url:
        description: URL to the EFM tarball to download and install.
        type: str
        required: false
        default: "https://archive.cloudera.com/p/CEM/redhat9/2.x/updates/2.1.3.0/tars/efm/efm-2.1.3.0-2-bin.tar.gz"
      efm_directory:
        description: Directory where EFM will be installed.
        type: str
        required: false
        default: "/opt/cloudera/cem"
      efm_properties_directory:
        description: Path to the EFM properties file.
        type: str
        required: false
        default: "/opt/cloudera/cem/efm/conf/efm.properties"
      efm_service_directory:
        description: Path to the EFM systemd service file.
        type: str
        required: false
        default: "/etc/systemd/system/efm.service"
      efm_user:
        description: System user to own EFM files and run the service.
        type: str
        required: false
        default: "efm"
      efm_group:
        description: System group to own EFM files.
        type: str
        required: false
        default: "efm"
      efm_server_address:
        description: The address to which the EFM server will bind.
        type: str
        required: false
        default: "0.0.0.0"
      efm_server_port:
        description: The port on which the EFM server will listen.
        type: str
        required: false
        default: "10090"
      efm_encryption_password:
        description: Password used for EFM encryption. This must be provided by the user.
        type: str
        required: true
      efm_repo_username:
        description: Username for protected Cloudera repositories (if required).
        type: str
        required: false
      efm_repo_password:
        description: Password for protected Cloudera repositories (if required).
        type: str
        required: false
      efm_tls_enabled:
        description: Enable or disable TLS/SSL for EFM server.
        type: bool
        default: false
      efm_ssl_client_auth:
        description: SSL client authentication mode (NONE, WANT, NEED).
        type: str
        default: "WANT"
      efm_ssl_keystore_type:
        description: Type of keystore (jks, pkcs12).
        type: str
        default: "jks"
      efm_ssl_truststore_type:
        description: Type of truststore (jks, pkcs12).
        type: str
        default: "jks"
      efm_ssl_keystore_path:
        description: Path to the SSL keystore file. Must be defined in playbook when efm_tls_enabled is true.
        type: str
        required: false
      efm_ssl_keystore_password:
        description: Password for the SSL keystore. Must be defined in playbook when efm_tls_enabled is true.
        type: str
        required: false
      efm_ssl_key_password:
        description: Password for the SSL private key. Must be defined in playbook when efm_tls_enabled is true.
        type: str
        required: false
      efm_ssl_truststore_path:
        description: Path to the SSL truststore file. Must be defined in playbook when efm_tls_enabled is true.
        type: str
        required: false
      efm_ssl_truststore_password:
        description: Password for the SSL truststore. Must be defined in playbook when efm_tls_enabled is true.
        type: str
        required: false
      efm_ldap_enabled:
        description: Enable or disable LDAP authentication for EFM.
        type: bool
        default: false
      efm_ldap_url:
        description: LDAP server URL. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_ldap_authentication_strategy:
        description: LDAP authentication strategy. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_ldap_user_auth_groups_manager:
        description: Authentication groups manager type. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_ldap_auth_enabled:
        description: Enable LDAP authentication. Must be defined in playbook when efm_ldap_enabled is true.
        type: bool
        required: false
      efm_ldap_auth_search_filter:
        description: LDAP search filter for user authentication. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_ldap_user_search_base:
        description: LDAP search base for users. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_ldap_user_object_class:
        description: LDAP object class for users. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_ldap_tls_protocol:
        description: TLS protocol version for LDAP connections. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_ldap_user_search_scope:
        description: LDAP search scope for users. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_ldap_user_identity_attribute:
        description: LDAP attribute used for user identity. Must be defined in playbook when efm_ldap_enabled is true.
        type: str
        required: false
      efm_db_url:
        description: Database connection URL.
        type: str
        default: "jdbc:postgresql://localhost:5432/efm"
      efm_db_driver_class:
        description: Database driver class name.
        type: str
        default: "org.postgresql.Driver"
      efm_db_username:
        description: Database username.
        type: str
        default: "efm"
      efm_db_password:
        description: Database password.
        type: str
        default: "efmPassword"
