# Copyright 2021 Cloudera, Inc. All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

- name: Create terraform template .tf files
  when: infra__terraform_tmp_dir is defined # TODO: Is this needed?
  block:
    - name: Create terraform template dir
      file:
        path: "{{ infra__terraform_tmp_dir }}/infra"
        state: directory

    # Apply template for Terraform provider
    - name: Generate Terraform Provider
      template:
        src: 'template/{{ infra__type }}/provider.tf.j2'
        dest: "{{ infra__terraform_tmp_dir }}/infra/provider.tf"

    # Apply template for Terraform variables
    - name: Generate Terraform Variables
      template:
        src: 'template/{{ infra__type }}/terraform_variables.tf.j2'
        dest: "{{ infra__terraform_tmp_dir }}/infra/variables.tf"
      no_log: false

    # NOTE: These don't work because not all variables are defined during teardown
    # # Apply template for Terraform infra....
    # # ...network resources
    # - name: Generate Terraform infra file for network resources
    #   template:
    #     src: 'template/{{ infra__type }}/infra_{{ infra__type }}_network.tf.j2'
    #     dest: "{{ infra__terraform_tmp_dir }}/infra/infra_network.tf"
    #   no_log: false

    # # ...storage resources
    # - name: Generating Terraform infra file for storage resources
    #   template:
    #     src: 'template/{{ infra__type }}/infra_{{ infra__type }}_storage.tf.j2'
    #     dest: "{{ infra__terraform_tmp_dir }}/infra/infra_storage.tf"
    #   no_log: false

    # # ...compute resources
    # - name: Generating Terraform infra file for compute resources
    #   template:
    #     src: 'template/{{ infra__type }}/infra_{{ infra__type }}_compute.tf.j2'
    #     dest: "{{ infra__terraform_tmp_dir }}/infra/infra_compute.tf"
    #   no_log: false

    - name: Prompt added by jenright 
      pause:
        prompt: "Terraform infra files for Teardown created in {{ infra__terraform_tmp_dir }}/infra"