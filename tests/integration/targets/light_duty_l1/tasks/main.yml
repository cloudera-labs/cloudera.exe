---

- name: Read CDP Public Cloud environment variables
  ansible.builtin.include_vars:
    file: cdp.yml
    name: __cdp
  tags: always

- name: Combine CDP Public Cloud environment variables with runtime variables
  ansible.builtin.set_fact:
    globals: "{{ __cdp.globals | default({}) | combine(globals | default({}), recursive=True) }}"
    env: "{{ __cdp.env | default({}) | combine(env | default({}), recursive=True) }}"
  tags: always

- name: Set up the CDP Public Cloud environment
  ansible.builtin.import_role:
    name: exec_cdp
  vars:
    install: yes
  tags: setup

- name: Run test tasks
  ansible.builtin.debug:
    msg: "No tests defined"
  tags: test

- name: Tear down the CDP Public Cloud environment
  ansible.builtin.import_role:
    name: exec_cdp
  vars:
    install: no
  tags: teardown